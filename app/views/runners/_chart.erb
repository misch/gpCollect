<script type="text/javascript" charset="utf-8">
    $(function(){
        new Highcharts.Chart({
            chart: {
                renderTo: "runs_chart"
            },
            title: {
                text: null
            },
            xAxis: {
                type: "datetime",
                tickPositioner: function() {
                    var ticks = [<%= RunDay.all.map { |run_day| ruby_to_javascript_date(run_day.date)}.join(',') %>];
                    //dates.info defines what to show in labels
                    //apparently dateTimeLabelFormats is always ignored when specifying tickPosistioner
                    ticks.info = {
                        unitName: "year", //unitName: "day",
                        higherRanks: {} // Omitting this would break things
                    };
                    return ticks;
                }
            },
            yAxis: {
                type: 'datetime', // y-axis will be in milliseconds
                dateTimeLabelFormats: { // force all formats to be hour:minute:second
                    second: '%H:%M:%S',
                    minute: '%H:%M:%S',
                    hour: '%H:%M:%S',
                    day: '%H:%M:%S',
                    week: '%H:%M:%S',
                    month: '%H:%M:%S',
                    year: '%H:%M:%S'
                },
                shared: true
            },
            tooltip: {
                useHTML: true,
                formatter: function() {
                    return '<b>' + this.series.name +'</b><br/>' +
                            Highcharts.dateFormat('%e. %b. %Y', new Date(this.x)) + '<br/>' +
                            Highcharts.dateFormat('%H:%M:%S', new Date(this.y));
                }
            },
            series: [
                <% if runners.size > 1 %>
                    <% runners.each do |runner| %>
                    {
                        name: "<%= runner.first_name %> <%= runner.last_name %>",
                        data: [<%= runner.runs.map {|r| "[#{ruby_to_javascript_date(r.run_day.date)}, #{r.duration}]" }.join(',') %>]
                    },
                    <% end %>
                <% end %>
                <% if runners.size == 1 %>
                {
                    name: "Category mean",
                    data: [<%= runners.first.runs.map { |r| "[#{ruby_to_javascript_date(r.run_day.date)}, #{r.mean_duration_for_run_day_category}]" }.join(',') %>]
                }
                <% end %>
            ]

        });
    });
</script>
<div id="runs_chart" style="width:100%; height:300px;"></div>
